JPA Dirty Checking

service 코드 진행 중 별도로 DB에 save하는 코드는 없음
1. 트랜잭션 시작
2. 엔티티 조회
3. 엔티티 값 변경
4. 트랜잭션 커밋
여기서 DB에 update 쿼리에 관한 코드는 없음
코드 동작 테스트를 해보니 로그에서 update 쿼리가 실행되었음

dirty란 상태의 변화가 생긴 정도로 이해하면 됨
즉, Dirty Checking 이란 상태 변경 검사 임

JPA에서는 트랜잭션이 끝나는 시점에 변화가 있는 모든 엔티티 객체를 DB에 자동으로 반영함
이 때, 변화가 있다의 기준은 최초 조희 상태 임

JPA에서는 엔티티를 조회하면 해당 엔티티의 조회 상태 그대로 스냅샷을 만들어놓음
그리고 트랜잭션이 끝나는 시점에는 이 스냅샷과 비교해서 다른점이 있다면 Update Query를 DB로 전달함

이런 상태 변경 검사의 대상은 영속성 컨텍스트가 관리하는 엔티티에만 적용됨
- detach된 엔티티 (준영속)
- DB에 반영되기 전 처음 생성된 엔티티 (비영속)
- 등등 준영속/비영속 상태의 엔티티는 Dirty Checking 대상에 포함되지 않음
즉, 값을 변경해도 DB에 반영되지 않는다는 것

Dirty Checking으로 생성되는 update 쿼리는 기본적으로 모든 필드를 업데이트 함
JPA에서는 전체 필드를 업데이트하는 방식을 기본값으로 사용
만약 필드가 많아 전체 업데이트가 부담스럽거나,
혹은 필요한 부분만 update하고 싶다면?
@DynamicUpdate를 선언하여 변경된 부분만 update 하도록 설정할 수 있음